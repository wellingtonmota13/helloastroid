{"version":3,"sources":["../../src/bootstrap/get-config-file.js"],"names":["levenshtein","require","fs","testRequireError","report","chalk","isNearMatch","fileName","configName","distance","get","module","exports","rootDir","configPath","configModule","readdir","then","files","find","file","split","pop","nearMatch","error","process","exit","console","log","bold","getConfigFile"],"mappings":";;;;;;;;;;;;AACA,IAAMA,cAAcC,QAAS,kBAAT,CAApB;AACA,IAAMC,KAAKD,QAAS,UAAT,CAAX;AACA,IAAME,mBAAmBF,QAAS,6BAAT,CAAzB;AACA,IAAMG,SAASH,QAAS,yBAAT,CAAf;AACA,IAAMI,QAAQJ,QAAS,OAAT,CAAd;;AAEA,SAASK,WAAT,CACEC,QADF,EAEEC,UAFF,EAGEC,QAHF,EAIW;AACT,SAAOT,YAAYU,GAAZ,CAAgBH,QAAhB,EAA0BC,UAA1B,KAAyCC,QAAhD;AACD;;AAEDE,OAAOC,OAAP;AAAA,sFAAiB,iBACfC,OADe,EAEfL,UAFe;AAAA,QAGfC,QAHe,uEAGI,CAHJ;AAAA;AAAA;AAAA;AAAA;AAAA;AAKTK,sBALS,GAKK,GAAED,OAAQ,IAAGL,UAAW,EAL7B;AAMXO,wBANW;AAAA;;AAQbA,2BAAed,QAAQa,UAAR,CAAf;AARa;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA,mBAUWZ,GAAGc,OAAH,CAAWH,OAAX,EAAoBI,IAApB,CAAyB;AAAA,qBAC/CC,MAAMC,IAAN,CAAW,gBAAQ;AACjB,oBAAMZ,WAAWa,KAAKC,KAAL,CAAWR,OAAX,EAAoBS,GAApB,EAAjB;AACA,uBAAOhB,YAAYC,QAAZ,EAAsBC,UAAtB,EAAkCC,QAAlC,CAAP;AACD,eAHD,CAD+C;AAAA,aAAzB,CAVX;;AAAA;AAUPc,qBAVO;;AAgBb,gBAAI,CAACpB,iBAAiBW,UAAjB,cAAL,EAAwC;AACtCV,qBAAOoB,KAAP,CAAc,kBAAiBhB,UAAW,EAA1C;AACAiB,sBAAQC,IAAR,CAAa,CAAb;AACD,aAHD,MAGO,IAAIH,SAAJ,EAAe;AACpBI,sBAAQC,GAAR,CAAa,EAAb;AACAxB,qBAAOoB,KAAP,CACG,wEAAuEnB,MAAMwB,IAAN,CACtEN,SADsE,CAEtE,SAAQlB,MAAMwB,IAAN,CAAWrB,UAAX,CAAuB,GAHnC;AAKAmB,sBAAQC,GAAR,CAAa,EAAb;AACAH,sBAAQC,IAAR,CAAa,CAAb;AACD;;AA5BY;AAAA,6CA+BRX,YA/BQ;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAAjB;;AAAA,WAAgCe,aAAhC;AAAA;AAAA;;AAAA,SAAgCA,aAAhC;AAAA","file":"get-config-file.js","sourcesContent":["/* @flow */\nconst levenshtein = require(`fast-levenshtein`)\nconst fs = require(`fs-extra`)\nconst testRequireError = require(`../utils/test-require-error`)\nconst report = require(`gatsby-cli/lib/reporter`)\nconst chalk = require(`chalk`)\n\nfunction isNearMatch(\n  fileName: string,\n  configName: string,\n  distance: number\n): boolean {\n  return levenshtein.get(fileName, configName) <= distance\n}\n\nmodule.exports = async function getConfigFile(\n  rootDir: string,\n  configName: string,\n  distance: number = 3\n) {\n  const configPath = `${rootDir}/${configName}`\n  let configModule\n  try {\n    configModule = require(configPath)\n  } catch (err) {\n    const nearMatch = await fs.readdir(rootDir).then(files =>\n      files.find(file => {\n        const fileName = file.split(rootDir).pop()\n        return isNearMatch(fileName, configName, distance)\n      })\n    )\n    if (!testRequireError(configPath, err)) {\n      report.error(`Could not load ${configName}`, err)\n      process.exit(1)\n    } else if (nearMatch) {\n      console.log(``)\n      report.error(\n        `It looks like you were trying to add the config file? Please rename \"${chalk.bold(\n          nearMatch\n        )}\" to \"${chalk.bold(configName)}\"`\n      )\n      console.log(``)\n      process.exit(1)\n    }\n  }\n\n  return configModule\n}\n"]}